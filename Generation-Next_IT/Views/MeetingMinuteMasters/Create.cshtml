@model Generation_Next_IT.Models.ViewModel.MeetingMinute_InputModel

@{
    ViewData["Title"] = "Create";
}


<form asp-action="Create" method="post">
    @Html.AntiForgeryToken()

    <div class="form-group mb-3">
        <label asp-for="CustomerType" class="control-label">Customer Type</label>
        <div>
            <label><input type="radio" asp-for="CustomerType" value="Corporate" /> Corporate</label>
            <label><input type="radio" asp-for="CustomerType" value="Individual" /> Individual</label>
        </div>
    </div>
    <section class="container-fluid mt-2">
        <div class="row">
            <div class="col-md-5">

                <div class="form-group">
                    <div class="row">
                        <div class="col-md-4">
                            <label asp-for="SelectedCustomerName" class="control-label">Customer Name</label>

                        </div>
                        <div class="col-md-8">
                            <div>
                                <select asp-for="SelectedCustomerName" class="form-control">
                                    @foreach (var customer in (IEnumerable<SelectListItem>)(ViewData["Customers"] ?? Enumerable.Empty<SelectListItem>()))
                                    {
                                        if (customer != null)
                                        {
                                            <option value="@customer.Value">@customer.Text</option>
                                        }
                                        else
                                        {
                                            <p style="color: orange;">Warning: Empty Customers list.</p>
                                        }
                                    }
                                </select>
                                <span asp-validation-for="SelectedCustomerName" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="row">
                        <div class="col-md-7">

                            <div class="form-group">
                                <div class="row mt-3">
                                    <label asp-for="Date" class="control-label col-md-4">Date</label>
                                    <div class="col-8">
                                        <input asp-for="Date" class="form-control" />
                                        <span asp-validation-for="Date" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="col-md-5">
                            <div class="form-group">
                                <div class="row mt-3">
                                    <label asp-for="Time" class="control-label col-auto col-md-2">Time</label>

                                    <div class="col-8 offset-2">
                                        <input asp-for="Time" class="form-control" />
                                        <span asp-validation-for="Time" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                        </div>


                    </div>
                </div>

                <div class="form-group mt-3">
                    <div class="row">
                        <div class="col-md-4">
                            <label asp-for="MeetingPlace" class="control-label">Meeting Place</label>
                        </div>
                        <div class="col-md-8">
                            <div>
                                <input asp-for="MeetingPlace" class="form-control" />
                                <span asp-validation-for="MeetingPlace" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group mt-3">
                    <div class="row">
                        <div class="col-md-4">
                            <label asp-for="AttendsFromClient" class="control-label">Attends From Client Side</label>
                        </div>
                        <div class="col-md-8">
                            <div>
                                <textarea asp-for="AttendsFromClient" class="form-control"></textarea>
                                <span asp-validation-for="AttendsFromClient" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group mt-3">
                    <div class="row">
                        <div class="col-md-4">
                            <label asp-for="AttendsFromHost" class="control-label">Attends From Host Side</label>
                        </div>
                        <div class="col-md-8">
                            <div>
                                <textarea asp-for="AttendsFromHost" class="form-control"></textarea>
                                <span asp-validation-for="AttendsFromHost" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>



            </div>
            <div class="col-md-1"></div>
            @* // left side *@
            <div class="col-md-6">
                <div class="form-group mt-3">
                    <div class="row">
                        <div class="col-md-4">
                            <label asp-for="Agenda" class="control-label">Agenda</label>
                        </div>
                        <div class="col-md-8">
                            <div>
                                <textarea asp-for="Agenda" class="form-control"></textarea>
                                <span asp-validation-for="Agenda" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group mt-3">
                    <div class="row">
                        <div class="col-md-4">
                            <label asp-for="Discussion" class="control-label">Discussion</label>
                        </div>
                        <div class="col-md-8">
                            <div>
                                <textarea asp-for="Discussion" class="form-control"></textarea>
                                <span asp-validation-for="Discussion" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group mt-3">
                    <div class="row">
                        <div class="col-md-4">
                            <label asp-for="Decision" class="control-label">Decision</label>
                        </div>
                        <div class="col-md-8">
                            <div>
                                <textarea asp-for="Decision" class="form-control"></textarea>
                                <span asp-validation-for="Decision" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>
   
    <section class="container-fluid mt-4 bg-light">
        <div class="form-group mt-3">
            <div class="row">
                <div class="col-md-6">
                    <div class="row mt-4">
                        <div class="col-md-5">
                            <label asp-for="ProductServiceID" class="control-label">Interested Product/Service</label>
                        </div>
                        <div class="col-md-7">
                            <div>
                                <select asp-for="ProductServiceID" class="form-control form-control-sm form-select " asp-items="@ViewBag.ProductsServices"></select>
                                <span asp-validation-for="ProductServiceID" class="text-danger"></span>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6"></div>
            </div>
            <div class="row mt-3">
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-8">
                                    <label asp-for="Quantity" class="control-label">Quantity</label>
                                </div>
                                <div class="col-4">
                                    <input asp-for="Quantity" class="form-control" />
                                    <span asp-validation-for="Quantity" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="row">
                                <div class="col-3">
                                    <label asp-for="Unit" class="control-label">Unit</label>
                                </div>
                                <div class="col-9">
                                    <input asp-for="Unit" class="form-control" readonly />
                                    <span asp-validation-for="Unit" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    
                </div>
            </div>
            <div class="row">
                <div class="col-md-2">
                    <a id="btnPlus" class="btn btn-secondary btn-sm m-2">Add</a>

                </div>
                <div class="col-md-10"></div>
            </div>

        </div>

        <div class="col-md-5">
            <div class="form-group">
                <div class="row">
                    
                </div>
            </div>

        </div>
    </section>

    <section class="container-fluid mt-4 bg-light">
 
            <div class="row mt-2">
                <div class="col-12">
                <table class="table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>
                                @Html.DisplayNameFor(model => model.ProductService)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Quantity)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Unit)
                            </th>
                            <th>Edit</th>
                            <th>Delete</th>
                        </tr>
                    </thead>
                    <tbody id="ProductsContainer">
                       <tr>
                            
                       </tr>
                    </tbody>
                </table>

                </div>
            </div>
    </section>
    <section class="container-fluid">
        <div class="form-group">
            <input type="submit" value="Save" class="btn btn-sm btn-secondary mt-3 mb-3" />
            <input type="reset" value="Refresh" class="btn btn-sm btn-secondary m-3" />
        </div>
    </section>


</form>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var customerDropdown = document.getElementById("SelectedCustomerName");
            var productServiceDropdown = document.getElementById("ProductServiceID");

            document.querySelectorAll('input[name="CustomerType"]').forEach(function (radio) {
                radio.addEventListener("change", function () {
                    fetch(`/MeetingMinuteMasters/GetCustomerNames?customerType=${this.value}`)
                        .then(response => response.json())
                        .then(data => {
                            while (customerDropdown.options.length > 0) {
                                customerDropdown.remove(0);
                            }

                            data.forEach(customer => {
                                var option = document.createElement("option");
                                option.value = customer.value;
                                option.text = customer.text;
                                customerDropdown.add(option);
                            });
                        })
                        .catch(error => console.error('Error:', error));
                });

                productServiceDropdown.addEventListener("change", function () {
                    console.log("Selected Product:", this.value);

                    fetch(`/MeetingMinuteMasters/GetUnit?productServiceID=${this.value}`)
                        .then(response => response.json())
                        .then(data => {
                            console.log("Unit data:", data);
                            document.getElementById("Unit").value = data.unit; 
                        })
                        .catch(error => console.error('Error:', error));
                });
            });
        });

     
 
        var addedProducts = [];

        function addProduct(product) {
            addedProducts.push(product);

            var tbody = document.getElementById('productTableBody');
            tbody.innerHTML = '';

            addedProducts.forEach(function (product, index) {
                var row = tbody.insertRow(index);
                var cellSL = row.insertCell(0);
                var cellName = row.insertCell(1);
                var cellQuantity = row.insertCell(2);
                var cellUnit = row.insertCell(3);
                var cellAction = row.insertCell(4);


                cellSL.innerHTML = index + 1;
                cellName.innerHTML = product.name;
                cellQuantity.innerHTML = product.quantity;
                cellUnit.innerHTML = product.unit;


                var editButton = document.createElement('button');
                editButton.type = 'button';
                editButton.className = 'btn btn-outline-success btn-sm';
                editButton.innerHTML = 'Edit';

                var deleteButton = document.createElement('button');
                deleteButton.type = 'button';
                deleteButton.className = 'btn btn-outline-danger btn-sm';
                deleteButton.innerHTML = 'Delete';

                cellAction.appendChild(editButton);
                cellAction.appendChild(deleteButton);
            });
        }

        var sampleProduct = { name: 'Sample Product', quantity: 5, unit: 'Pieces' };
        addProduct(sampleProduct);

        document.addEventListener("DOMContentLoaded", function () {
            var addButton = document.querySelector('.btn-secondary');

            addButton.addEventListener("click", function () {
                var newProduct = {
                    name: document.getElementById('ProductServiceID').value,
                    quantity: document.getElementById('Quantity').value,
                    unit: document.getElementById('Unit').value
                };

                addProduct(newProduct);
            });
        });
    </script>

}

